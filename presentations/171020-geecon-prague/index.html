<!DOCTYPE html><html lang="en"><head><meta charset="utf-8" /><title>srcdeps</title><meta content="yes" name="apple-mobile-web-app-capable" /><meta content="black-translucent" name="apple-mobile-web-app-status-bar-style" /><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, minimal-ui" name="viewport" /><link href="reveal.js-3.1.0/css/reveal.css" rel="stylesheet" /><link rel="stylesheet" href="reveal.js-3.1.0/css/theme/wildfly-swarm.css" id="theme" /><style>/* Stylesheet for CodeRay to match GitHub theme | MIT License | http://foundation.zurb.com */
/*pre.CodeRay {background-color:#f7f7f8;}*/
.CodeRay .line-numbers{border-right:1px solid #d8d8d8;padding:0 0.5em 0 .25em}
.CodeRay span.line-numbers{display:inline-block;margin-right:.5em;color:rgba(0,0,0,.3)}
.CodeRay .line-numbers strong{color:rgba(0,0,0,.4)}
table.CodeRay{border-collapse:separate;border-spacing:0;margin-bottom:0;border:0;background:none}
table.CodeRay td{vertical-align: top;line-height:1.45}
table.CodeRay td.line-numbers{text-align:right}
table.CodeRay td.line-numbers>pre{padding:0;color:rgba(0,0,0,.3)}
table.CodeRay td.code{padding:0 0 0 .5em}
table.CodeRay td.code>pre{padding:0}
.CodeRay .debug{color:#fff !important;background:#000080 !important}
.CodeRay .annotation{color:#a2a2ff}
.CodeRay .attribute-name{color:#000080}
.CodeRay .attribute-value{color:#700}
.CodeRay .binary{color:#509}
.CodeRay .comment{color:#ffff59;font-style:italic}
.CodeRay .char{color:#04d}
.CodeRay .char .content{color:#04d}
.CodeRay .char .delimiter{color:#039}
.CodeRay .class{color:#7d9eff;font-weight:bold}
.CodeRay .complex{color:#a08}
.CodeRay .constant,.CodeRay .predefined-constant{color:#00d2d2}
.CodeRay .color{color:#099}
.CodeRay .class-variable{color:#369}
.CodeRay .decorator{color:#b0b}
.CodeRay .definition{color:#099}
.CodeRay .delimiter{color:#000}
.CodeRay .doc{color:#970}
.CodeRay .doctype{color:#34b}
.CodeRay .doc-string{color:#d42}
.CodeRay .escape{color:#666}
.CodeRay .entity{color:#800}
.CodeRay .error{color:#ee78e6}
.CodeRay .exception{color:inherit}
.CodeRay .filename{color:#099}
.CodeRay .function{color:#900;font-weight:bold}
.CodeRay .global-variable{color:#00d2d2}
.CodeRay .hex{color:#058}
.CodeRay .integer,.CodeRay .float{color:#099}
.CodeRay .include{color:#555}
.CodeRay .inline{color:#000}
.CodeRay .inline .inline{background:#ccc}
.CodeRay .inline .inline .inline{background:#bbb}
.CodeRay .inline .inline-delimiter{color:#11dd3d}
.CodeRay .inline-delimiter{color:#11dd3d}
.CodeRay .important{color:#555;font-weight:bold}
.CodeRay .interpreted{color:#b2b}
.CodeRay .instance-variable{color:#00d2d2}
.CodeRay .label{color:#970}
.CodeRay .local-variable{color:#963}
.CodeRay .octal{color:#40e}
.CodeRay .predefined{color:#369}
.CodeRay .preprocessor{color:#579}
.CodeRay .pseudo-class{color:#555}
.CodeRay .directive{font-weight:bold}
.CodeRay .type{font-weight:bold}
.CodeRay .predefined-type{color:inherit}
.CodeRay .reserved,.CodeRay .keyword {color:#ee78e6;font-weight:bold}
.CodeRay .key{color:#ee78e6}
.CodeRay .key .delimiter{color:#ee78e6}
.CodeRay .key .char{color:#80f}
.CodeRay .value{color:#088}
.CodeRay .regexp .delimiter{color:#ee78e6}
.CodeRay .regexp .content{color:#ee78e6}
.CodeRay .regexp .modifier{color:#ee78e6}
.CodeRay .regexp .char{color:#11dd3d}
.CodeRay .regexp .function{color:#404;font-weight:bold}
.CodeRay .string{color:#d20}
.CodeRay .string .string .string{background:#ffd0d0}
.CodeRay .string .content{color:#11dd3d}
.CodeRay .string .char{color:#11dd3d}
.CodeRay .string .delimiter{color:#11dd3d}
.CodeRay .shell{color:#11dd3d}
.CodeRay .shell .delimiter{color:#11dd3d}
.CodeRay .symbol{color:#990073}
.CodeRay .symbol .content{color:#a60}
.CodeRay .symbol .delimiter{color:#630}
.CodeRay .tag{color:#00d2d2}
.CodeRay .tag-special{color:#d70}
.CodeRay .variable{color:#036}
.CodeRay .insert{background:#afa}
.CodeRay .delete{background:#faa}
.CodeRay .change{color:#aaf;background:#007}
.CodeRay .head{color:#f8f;background:none}
.CodeRay .insert .insert{color:#080}
.CodeRay .delete .delete{color:#800}
.CodeRay .change .change{color:#66f}
.CodeRay .head .head{color:#f4f}</style><link href="reveal.js-3.1.0/lib/css/zenburn.css" rel="stylesheet" /><script>document.write( '<link rel="stylesheet" href="reveal.js-3.1.0/css/print/' + ( window.location.search.match( /print-pdf/gi ) ? 'pdf' : 'paper' ) + '.css" type="text/css" media="print">' );</script></head><body><div class="reveal"><div class="slides"><section class="title"><h1><span class="image"><img src="images/srcdeps-logo-white-on-transparent-500x500.png" alt="srcdeps logo" width="130" height="130" /></span> <code>srcdeps</code></h1><div class="paragraph"><p>Source dependencies with Maven and Gradle</p></div>
<div class="paragraph"><p>&#160;</p></div>
<div class="paragraph"><p>Peter Palaga</p></div><p><small></small></p></section>
<section id="about_me"><h2>About me</h2><div class="paragraph text-left"><p>Peter Palaga</p></div>
<div class="ulist"><ul><li><p>Senior sustaining engineer at Red Hat Middleware</p><div class="ulist"><ul><li><p>JBoss Fuse/Apache Camel, JBoss EAP/WildFly and others</p></li></ul></div></li><li><p>Author of <code>srcdeps</code> <a href="https://github.com/srcdeps/srcdeps" class="bare">https://github.com/srcdeps/srcdeps</a></p></li><li><p>Views in this presentation are my own</p></li></ul></div>
<aside class="notes"><div class="ulist"><ul><li><p>EAP stands for Enterprise Application Platform</p></li><li><p>It is the Java EE Application Server with commercial support from Red Hat</p></li><li><p>Based on the community project called WildFly</p></li><li><p>&#8230;&#8203; and there is my twitter handle at the bottom</p></li></ul></div></aside></section>
<section id="agenda"><h2>Agenda</h2><div class="ulist"><ul><li><p>Source dependencies:</p><div class="ulist"><ul><li><p>What is it</p></li><li><p>What is it good for</p></li></ul></div></li><li><p><code>srcdeps</code> - the implementation for Maven and Gradle</p></li><li><p>Demo</p></li><li><p>Limitations</p></li></ul></div>
<aside class="notes"><div class="ulist"><ul><li><p>This is a shorter version of this talk</p></li><li><p>CI/CD parts stripped out</p></li><li><p>Next slide: To warm up, please raise your hand&#8230;&#8203;</p></li></ul></div></aside></section>
<section><section id="what_are_source_dependencies"><h2>What are source dependencies?</h2></section><section id="the_usual_dependencies"><h2>The "usual" dependencies</h2><div class="ulist"><ul><li><p>Software projects often depend on <strong>artifacts</strong> produced by other projects</p></li><li><p>Those artifacts</p><div class="ulist"><ul><li><p>typically contain compiled code</p></li><li><p>usually available in repositories (Maven Central, jcenter, &#8230;&#8203;) on the internet</p></li></ul></div></li><li><p>Build tools (Maven, Gradle, &#8230;&#8203;) responsible for finding and downloading the dependencies</p></li></ul></div></section><section id="source_dependencies"><h2>Source dependencies</h2><div class="ulist"><ul><li><p>The build of every git commit deterministic enough</p><div class="paragraph"><p>&#8658; Source code of a dependency enough to use it in a dependent project</p></div></li><li><p>The build tool has to:</p><div class="ulist"><ul><li><p>Check out the sources (e.g. from a git repo)</p></li><li><p>Build the artifacts required by the dependent project</p></li></ul></div></li></ul></div>
<div class="paragraph"><p>NB: Dependency artifacts do not need to be available in a repository</p></div></section></section>
<section><section id="the_idea_is_not_new"><h2>The idea is not new</h2><div class="paragraph"><p>Some languages (or their build tools) have it already</p></div></section><section id="ruby"><h2>Ruby</h2><div class="paragraph"><p><code>Gemfile</code> of a Ruby project</p></div>
<div class="listingblock"><div class="content"><pre class="CodeRay"><code class="ruby language-ruby"><span class="comment"># A binary dependency pulled from rubygems.org</span>
gem <span class="string"><span class="delimiter">'</span><span class="content">rack</span><span class="delimiter">'</span></span>, <span class="string"><span class="delimiter">'</span><span class="content">2.0.1</span><span class="delimiter">'</span></span>

<span class="comment"># A source dependency built by Blunder</span>
<span class="comment"># from a git commit</span>
gem <span class="string"><span class="delimiter">'</span><span class="content">rack</span><span class="delimiter">'</span></span>,
    <span class="symbol">:git</span> =&gt; <span class="string"><span class="delimiter">'</span><span class="content">https://github.com/rack/rack.git</span><span class="delimiter">'</span></span>,
    <span class="symbol">:ref</span> =&gt; <span class="string"><span class="delimiter">'</span><span class="content">0bd839d</span><span class="delimiter">'</span></span></code></pre></div></div></section><section id="scala"><h2>Scala</h2><div class="paragraph"><p><code>build.sbt</code></p></div>
<div class="listingblock"><div class="content"><pre class="CodeRay"><code class="java language-java"><span class="comment">// A binary dependency</span>
libraryDependencies +=
    <span class="string"><span class="delimiter">&quot;</span><span class="content">com.typesafe.play</span><span class="delimiter">&quot;</span></span> %% <span class="string"><span class="delimiter">&quot;</span><span class="content">play-slick</span><span class="delimiter">&quot;</span></span> % <span class="string"><span class="delimiter">&quot;</span><span class="content">2.0.2</span><span class="delimiter">&quot;</span></span>

<span class="comment">// A source dependency</span>
myProject
  .dependsOn(
    ProjectRef(
      uri(<span class="string"><span class="delimiter">&quot;</span><span class="content">git://github.com/freekh/play-slick.git#v1.2.3</span><span class="delimiter">&quot;</span></span>)
      <span class="string"><span class="delimiter">&quot;</span><span class="content">play-slick</span><span class="delimiter">&quot;</span></span>
    )
  )</code></pre></div></div>
<aside class="notes"><div class="ulist"><ul><li><p>Anybody knows any other language/build tool allowing this?</p></li></ul></div></aside></section></section>
<section><section id="what_is_this_good_for"><h2>What is this good for?</h2><div class="paragraph"><p>Generally:</p></div><div class="ulist"><ul><li><p>No release of the dependency in a remote artifact repository such as Maven Central</p></li><li><p>Sources of the dependency available</p></li></ul></div></section><section id="testing_and_integration"><h2>Testing and Integration</h2><div class="ulist"><ul><li><p>Test each commit of the dependency inside the dependent project</p></li><li><p>Find issues early</p></li><li><p>Speedup the delivery of the dependent project</p></li></ul></div></section><section id="multilayer_continuous_delivery"><h2>Multilayer Continuous Delivery</h2><div class="paragraph"><p>Multiple components in multiple separate source repositories</p></div>
<div class="imageblock" style=""><img src="images/wf-component-dependencies.svg" alt="wf component dependencies" /></div>
<aside class="notes"><div class="ulist"><ul><li><p>The components depend on each other, building a dependency hierarchy</p></li><li><p>Independent release cycles</p></li></ul></div></aside></section><section id="fixing_third_party_code_1_2"><h2>Fixing third-party code (1/2)</h2><div class="paragraph"><p>Dependency project dead or not releasing fast enough</p></div>
<div class="ulist"><ul><li><p>Fork and use as a source dependency</p></li><li><p>No consent from the dependency project needed</p></li></ul></div></section><section id="fixing_third_party_code_2_2"><h2>Fixing third-party code (2/2)</h2><div class="paragraph"><p>Dependency project doing nasty things</p></div>
<div class="ulist"><ul><li><p>Fork and accept only some of their changes (e.g. security fixes)</p></li><li><p>Throw away all that can harm your stability</p></li><li><p>Again, no consent from the dependency project needed</p></li></ul></div></section></section>
<section><section id="how_is_this_different_from_maven_snapshots"><h2>How is this different from Maven SNAPSHOTs?</h2></section><section id="snapshots_built_locally"><h2>SNAPSHOTs built locally</h2><div class="ulist"><ul><li><p>What you build is what you get</p></li><li><p>Handy on a developer&#8217;s machine</p></li><li><p>Hard to share:</p><div class="ulist"><ul><li><p>CI machines</p></li><li><p>Teammates</p></li></ul></div></li></ul></div></section><section id="remote_snapshots_are_evil"><h2>Remote SNAPSHOTs are evil</h2><div class="ulist"><ul><li class="fragment"><p>You never know what you get</p><div class="ulist"><ul><li><p>local/remote SNAPSHOT?</p></li><li><p>latest today != latest tomorrow</p><div class="paragraph"><p>&#160;</p></div></li></ul></div></li><li class="fragment"><p>The build of a component depending on another SNAPSHOT component</p><div class="ulist"><ul><li><p><strong>Not reproducible</strong> over time</p></li><li><p>Reverts won&#8217;t bring the previous working state</p><div class="paragraph"><p>&#160;</p></div></li></ul></div></li><li class="fragment"><p>Remote SNAPSHOTs should be always off</p></li></ul></div>
<aside class="notes"><div class="ulist"><ul><li><p>Once you enable remote SNAPSHOTS&#8230;&#8203;</p></li></ul></div></aside></section><section id="source_dependencies_2"><h2>Source dependencies</h2><div class="ulist"><ul><li class="fragment"><p>As compared to SNAPSHOTs:</p><div class="ulist"><ul><li><p>Reproducible</p></li><li><p>Easy to share with teammates and CI</p><div class="paragraph"><p>&#160;</p></div></li></ul></div></li><li class="fragment"><p>As compared to traditional releases:</p><div class="ulist"><ul><li><p>Releases done just for the sake of testing and integration may be avoided</p></li><li><p>May eliminate the need for releases and the artifact repository infra altogether</p></li></ul></div></li></ul></div></section></section>
<section><section id="_code_srcdeps_code"><h2><code>srcdeps</code></h2><div class="ulist"><ul><li class="fragment"><p><code><a href="https://github.com/srcdeps/srcdeps-maven">srcdeps-maven</a></code> since 2015/10, now robust and stable</p></li><li class="fragment"><p><code><a href="https://github.com/srcdeps/srcdeps-core">srcdeps-core</a></code> for common functionality</p></li><li class="fragment"><p><code><a href="https://github.com/srcdeps/srcdeps-gradle-plugin">srcdeps-gradle-plugin</a></code> released two days ago</p></li><li class="fragment"><p><code>ant</code> and <code>sbt</code> contributions welcome :)</p></li></ul></div><aside class="notes"><div class="ulist"><ul><li><p><code>core</code> to be able to support other build tools</p></li><li><p>Gradle plugin very new, expect all kinds of issues</p></li><li><p>Thanks GeeCon for accepting this talk and thus motivating me to finsh the Gradle plugin :)</p></li></ul></div></aside></section><section id="how_code_srcdeps_code_work_1_4"><h2>How <code>srcdeps</code> work (1/4)</h2><div class="paragraph"><p>Three basic ideas</p></div>
<div class="olist arabic"><ol class="arabic"><li class="fragment"><p>Coin a convention for version strings to express the commit ID to build the given dependency from</p><div class="listingblock"><div class="content"><pre class="CodeRay"><code class="xml language-xml"><span class="tag">&lt;dependency&gt;</span>
  <span class="tag">&lt;groupId&gt;</span>org.my-group<span class="tag">&lt;/groupId&gt;</span>
  <span class="tag">&lt;artifactId&gt;</span>my-artifact<span class="tag">&lt;/artifactId&gt;</span>
  <span class="tag">&lt;version&gt;</span>1.2.3-SRC-revision-<strong>deadbeef</strong><span class="tag">&lt;/version&gt;</span>
<span class="tag">&lt;/dependency&gt;</span><span class="comment">&lt;!--             ⬑ a git commit ID  --&gt;</span></code></pre></div></div></li></ol></div>
<aside class="notes"><div class="ulist"><ul><li><p>The 3 hold for each build tool.</p></li></ul></div></aside></section><section id="how_code_srcdeps_code_work_2_4"><h2>How <code>srcdeps</code> work (2/4)</h2><div class="olist arabic"><ol class="arabic" start="2"><li><p>Provide a configuration that maps dependency artifacts to source repository URLs</p><div class="listingblock"><div class="content"><pre class="CodeRay"><code class="yaml language-yaml"><span class="key">configModelVersion</span>: <span class="string"><span class="content">2.1</span></span>  <span class="comment"># srcdeps.yaml file</span>
<span class="key">repositories</span>:
  <span class="key">junit</span>:
    <span class="key">selectors</span>:
    - <span class="string"><span class="content">junit</span></span> <span class="comment"># a groupId[:artifactId[:version]] pattern</span>
            <span class="comment"># may contain * wildcards</span>
    <span class="key">urls</span>:
    - <span class="string"><span class="content">git:https://github.com/ppalaga/junit4.git</span></span></code></pre></div></div></li></ol></div></section><section id="how_code_srcdeps_code_work_3_4"><h2>How <code>srcdeps</code> work (3/4)</h2><div class="olist arabic"><ol class="arabic" start="3"><li><p>Mechanism to trigger the build of the dependency:</p><div class="ulist"><ul><li><p>Maven: custom implementation of the Local Maven Repository</p></li><li><p>Gradle: <code>srcdeps</code> plugin scans the dependencies during <code>afterEvaluate</code> phase</p></li></ul></div></li></ol></div></section><section id="how_code_srcdeps_code_work_4_4"><h2>How <code>srcdeps</code> work (4/4)</h2><div class="paragraph text-left"><p>When an artifact with <code>*-SRC-revision-{commitId}</code> version is found</p></div>
<div class="ulist"><ul><li class="fragment"><p>Find a git URL for it in <code>srcdeps.yaml</code></p></li><li class="fragment"><p>Checkout the source to <code>~/.m2/srcdeps</code> directory</p></li><li class="fragment"><p>Change the versions in the <code>pom.xml</code>/<code>build.gradle</code> files to whatever <code>*-SRC-revision-{commitId}</code> was requested</p></li><li class="fragment"><p>Build the dependency and install the resulting artifacts locally</p></li><li class="fragment"><p>The primary build then takes the artifacts from the Maven Local Repository</p></li></ul></div></section></section>
<section><section id="demo_code_srcdeps_code_with_maven"><h2>Demo: <code>srcdeps</code> with Maven</h2><div class="paragraph"><p><a href="#/_code_srcdeps_code_features">Skip things shown live</a></p></div></section><section id="let_s_have_a_simple_project"><h2>Let&#8217;s have a simple project</h2><div class="listingblock"><div class="content"><pre class="CodeRay"><code class="java language-java"><span class="directive">public</span> <span class="type">class</span> <span class="class">Demo</span> {
  <span class="directive">public</span> <span class="predefined-type">String</span> sayHello() {
    <span class="keyword">return</span> <span class="string"><span class="delimiter">&quot;</span><span class="content">Hello World!</span><span class="delimiter">&quot;</span></span>;
  }
}

<span class="directive">public</span> <span class="type">class</span> <span class="class">DemoTest</span> {
  <span class="annotation">@Test</span>
  <span class="directive">public</span> <span class="type">void</span> sayHelloTest() {
    Assert.assertEquals(<span class="string"><span class="delimiter">&quot;</span><span class="content">Hello World!</span><span class="delimiter">&quot;</span></span>, <span class="keyword">new</span> Demo().sayHello());
  }
}</code></pre></div></div></section><section id="we_need_a_new_assertion"><h2>We need a new assertion</h2><div class="listingblock"><div class="content"><pre class="CodeRay"><code class="java language-java"><span class="directive">public</span> <span class="type">class</span> <span class="class">Demo</span> {
  <span class="directive">public</span> <span class="predefined-type">String</span> sayHello() {
    <span class="keyword">return</span> <span class="string"><span class="delimiter">&quot;</span><span class="content">Hello World!</span><span class="delimiter">&quot;</span></span>;
  }
}

<span class="directive">public</span> <span class="type">class</span> <span class="class">DemoTest</span> {
  <span class="annotation">@Test</span>
  <span class="directive">public</span> <span class="type">void</span> sayHelloTest() {
    Assert.<strong class="keyword">assertHelloGeeCon</strong>(<span class="keyword">new</span> Demo().sayHello());
    <span class="comment">//      ⬑ not available in the stock jUnit :(</span>
  }
}</code></pre></div></div></section><section id="clone_junit"><h2>Clone JUnit</h2><div class="listingblock"><div class="content"><pre class="CodeRay"><code class="java language-java"><span class="directive">public</span> <span class="type">class</span> <span class="class">Assert</span> {

  <span class="comment">// Add the new method to org.junit.Assert</span>
  <span class="directive">public</span> <span class="directive">static</span> <span class="type">void</span> assertHelloGeeCon(<span class="predefined-type">String</span> actual) {
    assertEquals(
      <span class="string"><span class="delimiter">&quot;</span><span class="content">Not the right conference!!!</span><span class="delimiter">&quot;</span></span>,
      <span class="string"><span class="delimiter">&quot;</span><span class="content">Hello GeeCon!</span><span class="delimiter">&quot;</span></span>, actual
    );
  }
...</code></pre></div></div>
<div class="paragraph"><p>... and commit and push to your fork</p></div></section><section id="intialize_code_srcdeps_code_configuration_in_the_dependent_project"><h2>Intialize <code>srcdeps</code> configuration in the dependent project</h2><div class="listingblock"><div class="content"><pre class="CodeRay"><code class="shell language-shell">mvn org.srcdeps.mvn:srcdeps-maven-plugin:3.2.0:init</code></pre></div></div>
<div class="paragraph"><p>That generates <code>.mvn/extensions.xml</code> and <code>.mvn/srcdeps.yaml</code> files for you</p></div></section><section id="_code_mvn_extensions_xml_code"><h2><code>.mvn/extensions.xml</code></h2><div class="listingblock"><div class="content"><pre class="CodeRay"><code class="xml language-xml"><span class="tag">&lt;extensions&gt;</span>
  <span class="tag">&lt;extension&gt;</span>
    <span class="tag">&lt;groupId&gt;</span>org.l2x6.srcdeps<span class="tag">&lt;/groupId&gt;</span>
    <span class="tag">&lt;artifactId&gt;</span>srcdeps-maven-local-repository<span class="tag">&lt;/artifactId&gt;</span>
    <span class="tag">&lt;version&gt;</span>3.2.0<span class="tag">&lt;/version&gt;</span>
  <span class="tag">&lt;/extension&gt;</span>
<span class="tag">&lt;/extensions&gt;</span></code></pre></div></div>
<div class="ulist"><ul><li><p>Maven Core Extensions since Maven 3.3.1</p></li><li><p>Allows for replacing substantial parts of Maven by our own custom implementations</p></li><li><p>Much more powerful than the plugin API</p><div class="ulist"><ul><li><p>Parent, BoM imports are looked up earlier than any plugin code can be invoked</p></li></ul></div></li></ul></div></section><section id="_code_srcdeps_yaml_code"><h2><code>srcdeps.yaml</code></h2><div class="listingblock"><div class="content"><pre class="CodeRay"><code class="yaml language-yaml"><span class="key">configModelVersion</span>: <span class="string"><span class="content">2.2</span></span>
<span class="key">repositories</span>:
  <span class="key">junit</span>:
    <span class="key">selectors</span>:
    - <span class="string"><span class="content">junit</span></span> <span class="comment"># a groupId[:artifactId[:version]] pattern</span>
            <span class="comment"># may contain * wildcards</span>
    <span class="key">urls</span>:
    - <span class="string"><span class="content">git:https://github.com/ppalaga/junit4.git</span></span></code></pre></div></div>
<div class="ulist"><ul><li><p>A mapping from artifacts to git URLs</p></li><li><p>Plus a few other options</p></li></ul></div></section><section id="upgrade_code_junit_code_in_the_dependent_project"><h2>Upgrade <code>junit</code> in the dependent project</h2><div class="listingblock"><div class="content"><pre class="CodeRay"><code class="xml language-xml">...
<span class="tag">&lt;dependency&gt;</span>
  <span class="tag">&lt;groupId&gt;</span>junit<span class="tag">&lt;/groupId&gt;</span>
  <span class="tag">&lt;artifactId&gt;</span>junit<span class="tag">&lt;/artifactId&gt;</span>
  <span class="tag">&lt;scope&gt;</span>test<span class="tag">&lt;/scope&gt;</span>
  <span class="tag">&lt;version&gt;</span>4.13-SRC-revision-<strong>fd0a1c029b99277c955417b0c</strong><span class="tag">&lt;/version&gt;</span>
<span class="tag">&lt;/dependency&gt;</span>
...</code></pre></div></div></section><section id="build_the_dependent_project"><h2>Build the dependent project</h2><div class="listingblock"><div class="content"><pre class="CodeRay"><code class="shell language-shell">cd srcdeps-demo
mvn clean test
...
Failed tests:
  sayHelloTest(org.srcdeps.DemoTest): Not the right conference!
    expected:&lt;Hello [GeeCon]!&gt; but was:&lt;Hello [World]!&gt;
...</code></pre></div></div>
<div class="paragraph"><p>Fix <code>Demo.sayHello()</code> to return <code>"Hello GeeCon!"</code></p></div>
<div class="listingblock"><div class="content"><pre class="CodeRay"><code class="shell language-shell">cd srcdeps-demo
mvn clean test
...
Tests run: 1, Failures: 0, Errors: 0, Skipped: 0
...
BUILD SUCCESS</code></pre></div></div>
<div class="paragraph"><p>Q.E.D.</p></div></section><section id="interesting_locations"><h2>Interesting locations</h2><div class="ulist"><ul><li><p>The source dependency was built under <code>${local.maven.repo.dir}/../srcdeps/${groupId}</code>, typically <code>~/.m2/srcdeps/${groupId}</code></p></li><li><p>The source dependency was installed in the local Maven repo, typically `~/.m2/repository</p></li></ul></div></section></section>
<section><section id="_code_srcdeps_code_for_gradle"><h2><code>srcdeps</code> for Gradle</h2><div class="ulist"><ul><li class="fragment"><p>Very new, expect all kinds of issues</p></li><li class="fragment"><p>Objective: suppot all combinations</p><div class="imageblock" style=""><img src="images/maven-gradle-matrix.svg" alt="maven gradle matrix" /></div></li><li class="fragment"><p>Maven local repository used to install/pull source dependencies</p></li></ul></div><aside class="notes"><div class="ulist"><ul><li><p>Objective: support all possible { Maven | Gradle } x { dependent | dependency } scenarios</p><div class="ulist"><ul><li><p>Maven project may depend on both Maven and Gradle projects</p></li><li><p>Gradle project may depend on both Maven and Gradle projects</p><div class="paragraph"><p>*</p></div></li></ul></div></li></ul></div></aside></section><section id="challenges_with_gradle"><h2>Challenges with Gradle</h2><div class="ulist"><ul><li><p>Versions scattered all over the build scripts</p></li><li><p>Mechanical transformation not possible</p></li></ul></div>
<aside class="notes"><div class="ulist"><ul><li><p>As you have seen earlier, when building a source dependency, a substantial part of the effort is to persuade
the build tool to produce artifacts with the desired version string</p></li></ul></div>
<div class="paragraph"><p>Maven:</p></div>
<div class="ulist"><ul><li><p>Overwriting versions easy, <code>pom.xml</code> files have strict structure</p></li><li><p>Installing artifacts to the local repo a built in feature</p></li></ul></div>
<div class="paragraph"><p>Gradle:</p></div>
<div class="paragraph"><p>there is no <code>versions-gradle-plugin</code>)</p></div></aside></section><section id="customizing_gradle_builds"><h2>Customizing Gradle builds</h2><div class="paragraph text-left"><p><code>srcdeps</code> injects a piece of script to change the build model dynamically</p></div>
<div class="listingblock"><div class="content"><pre class="CodeRay"><code class="groovy language-groovy">gradle.projectsLoaded {
  gradle.rootProject.properties[<span class="string"><span class="delimiter">'</span><span class="content">allprojects</span><span class="delimiter">'</span></span>].each {
    <span class="local-variable">it</span>.afterEvaluate { project -&gt;
      <span class="keyword">if</span> (!project.plugins.hasPlugin(<span class="string"><span class="delimiter">'</span><span class="content">maven</span><span class="delimiter">'</span></span>)) {
        <span class="comment">// Add maven plugin to be able to install</span>
        <span class="comment">// to local Maven repo</span>
        project.plugins.apply(<span class="string"><span class="delimiter">'</span><span class="content">maven</span><span class="delimiter">'</span></span>)
      }
      <span class="comment">// Change the version</span>
      project.version = srcdepsInner.version
    }
  }
} <span class="comment">// Default script overridable in `srcdeps.yaml`</span></code></pre></div></div>
<aside class="notes"><div class="paragraph"><p>Gradle has to be defeated with its own weapons
When building a Gradle dependency &#8230;&#8203;</p></div></aside></section><section id="gradle_demo"><h2>Gradle demo</h2></section></section>
<section id="_code_srcdeps_code_features"><h2><code>srcdeps</code> features</h2><div class="ulist"><ul><li><p>Dependencies can refer to not only commits, but also branches and tags:</p><div class="ulist"><ul><li><p><code>1.2.3-SRC-revision-{myCommitId}</code></p></li><li><p><code>1.2.3-SRC-branch-{myBranchName}</code></p></li><li><p><code>1.2.3-SRC-revision-{myTagName}</code></p><div class="paragraph"><p>&#160;</p></div></li></ul></div></li><li><p>In Maven, source dependencies work for vitually any kind of a dependency incl. parent, managed imports and even plugins</p></li><li><p>In Gradle, tested only compile and test deps</p></li></ul></div></section>
<section id="_code_srcdeps_yaml_code_config_options"><h2><code>srcdeps.yaml</code> config. options</h2><div class="ulist"><ul><li><p><code>verbosity</code> of dependency builds</p></li><li><p>Custom arguments for dependency builds, e.g. <code>-Dcheckstyle.skip</code></p></li><li><p><code>-DskipTests</code> by default</p></li><li><p><code>buildTimeout</code></p></li><li><p>By default <code>failWith: {goals: release:prepare}</code> to prevent releases with source dependencies</p></li><li><p>See <a href="https://github.com/srcdeps/srcdeps-core/blob/master/doc/srcdeps.yaml" class="bare">https://github.com/srcdeps/srcdeps-core/blob/master/doc/srcdeps.yaml</a></p></li></ul></div></section>
<section><section id="limitations"><h2>Limitations</h2><div class="paragraph"><p>Can you think of any?</p></div><div class="ulist"><ul><li class="fragment"><p>Tools unaware of <code>srcdeps</code> (IDEs, static pom.xml analysers, &#8230;&#8203;) will see the <code>-SRC-</code> deps as non-available</p></li><li class="fragment"><p>Only git supported ATM</p></li><li class="fragment"><p>Gradle support new, Ant and sbt wait for contributions</p></li><li class="fragment"><p>However immutable git commits are, they can still disappear from repos, or even the whole repo can be deleted</p><div class="ulist"><ul><li><p>Use your own forks/mirrors instead of third party repos</p></li></ul></div></li></ul></div></section><section id="limitations_build_reproducibility"><h2>Limitations: build reproducibility</h2><div class="paragraph"><p>The jars and wars built at two occasions will not be the same</p></div>
<div class="ulist"><ul><li class="fragment"><p>Not a <code>srcdeps</code> specific problem</p></li><li class="fragment"><p>Java and build tool versions</p><div class="ulist"><ul><li><p><code>mvnw</code> and <code>enforcer</code> to mitigate</p></li></ul></div></li><li class="fragment"><p>Env and time dependent inputs</p></li><li class="fragment"><p>ZIP spec requires the entries to be timestamped</p></li></ul></div></section><section id="limitations_build_def_clash"><h2>Limitations: build def clash</h2><div class="paragraph"><p><code>srcdeps</code> lets the dependent project specify the build command</p></div>
<div class="ulist"><ul><li class="fragment"><p>A clash may happen:</p></li><li class="fragment"><p>Two distinct projects depend on the same revision but want a different build</p></li><li class="fragment"><p>Only the first command is executed</p></li></ul></div>
<aside class="notes"><div class="ulist"><ul><li><p>cmd including goals, profiles, system properties, env vars, &#8230;&#8203;</p></li></ul></div></aside></section></section>
<section><section id="release_to_a_public_maven_repo_with_code_srcdeps_code"><h2>Release to a public Maven repo with <code>srcdeps</code>?</h2><div class="paragraph"><p><strong>NO</strong></p></div><div class="paragraph"><p><code>srcdeps</code> transparent only to the immediate descendants</p></div><aside class="notes"><div class="ulist"><ul><li><p>Release to a public Maven repo
*</p></li></ul></div></aside></section><section id="go_to_production_with_code_srcdeps_code"><h2>Go to production with <code>srcdeps</code>?</h2><div class="paragraph"><p>Why not?</p></div>
<div class="paragraph"><p>As long as your ZIP, RPM, Docker deliverable contains all binary deps</p></div></section></section>
<section id="_code_srcdeps_code_wrap_up"><h2><code>srcdeps</code> wrap up</h2><div class="ulist"><ul><li class="fragment"><p>A tool for Maven and Gradle</p></li><li class="fragment"><p>Allows declaring dependencies in terms of source commits instead of released versions</p></li></ul></div></section>
<section id="_code_srcdeps_code_project_info"><h2><code>srcdeps</code> project info</h2><div class="ulist"><ul><li><p>All code and contributions are under Apache License v2</p></li><li><p>Documentation: <a href="https://github.com/srcdeps/srcdeps/blob/master/README.adoc" class="bare">https://github.com/srcdeps/srcdeps/blob/master/README.adoc</a></p></li><li><p>Quickstarts: <a href="https://github.com/srcdeps/srcdeps-maven/tree/master/srcdeps-maven-quickstarts" class="bare">https://github.com/srcdeps/srcdeps-maven/tree/master/srcdeps-maven-quickstarts</a></p></li><li><p>Issues and discussions: <a href="https://github.com/srcdeps/srcdeps-maven/issues" class="bare">https://github.com/srcdeps/srcdeps-maven/issues</a></p></li><li><p><a href="https://twitter.com/ppalaga" class="bare">https://twitter.com/ppalaga</a></p></li></ul></div>
<div class="paragraph"><p>Contributions welcome!</p></div></section>
<section id=""><h2>&#160;</h2><div class="paragraph"><p>Thanks!</p></div></section></div>
                      <div class="footer">
                        <div class="left">
                          <img src="images/srcdeps-logo-323232-on-transparent-500x500-smoth.png" />srcdeps
                        </div>
                                <a href="https://twitter.com/ppalaga">@ppalaga</a>
                        <div class="right">
                          <img id="geecon-logo" src="images/geecon-logo.png" />
                        </div>
                      </div></div><script src="reveal.js-3.1.0/lib/js/head.min.js"></script><script src="reveal.js-3.1.0/js/reveal.js"></script><script>// See https://github.com/hakimel/reveal.js#configuration for a full list of configuration options
Reveal.initialize({
  // Display controls in the bottom right corner
  controls: false,
  // Display a presentation progress bar
  progress: true,
  // Display the page number of the current slide
  slideNumber: false,
  // Push each slide change to the browser history
  history: true,
  // Enable keyboard shortcuts for navigation
  keyboard: true,
  // Enable the slide overview mode
  overview: true,
  // Vertical centering of slides
  center: true,
  // Enables touch navigation on devices with touch input
  touch: true,
  // Loop the presentation
  loop: false,
  // Change the presentation direction to be RTL
  rtl: false,
  // Turns fragments on and off globally
  fragments: true,
  // Flags if the presentation is running in an embedded mode,
  // i.e. contained within a limited portion of the screen
  embedded: false,
  // Number of milliseconds between automatically proceeding to the
  // next slide, disabled when set to 0, this value can be overwritten
  // by using a data-autoslide attribute on your slides
  autoSlide: 0,
  // Stop auto-sliding after user input
  autoSlideStoppable: true,
  // Enable slide navigation via mouse wheel
  mouseWheel: false,
  // Hides the address bar on mobile devices
  hideAddressBar: true,
  // Opens links in an iframe preview overlay
  previewLinks: false,
  // Theme (e.g., beige, black, league, night, serif, simple, sky, solarized, white)
  // NOTE setting the theme in the config no longer works in reveal.js 3.x
  //theme: Reveal.getQueryHash().theme || 'wildfly-swarm',
  // Transition style (e.g., none, fade, slide, convex, concave, zoom)
  transition: Reveal.getQueryHash().transition || 'linear',
  // Transition speed (e.g., default, fast, slow)
  transitionSpeed: 'default',
  // Transition style for full page slide backgrounds (e.g., none, fade, slide, convex, concave, zoom)
  backgroundTransition: 'fade',
  // Number of slides away from the current that are visible
  viewDistance: 3,
  // Parallax background image (e.g., "'https://s3.amazonaws.com/hakim-static/reveal-js/reveal-parallax-1.jpg'")
  parallaxBackgroundImage: '',
  // Parallax background size in CSS syntax (e.g., "2100px 900px")
  parallaxBackgroundSize: '',

  // The "normal" size of the presentation, aspect ratio will be preserved
  // when the presentation is scaled to fit different resolutions. Can be
  // specified using percentage units.
  width: 960,
  height: 700,

  // Factor of the display size that should remain empty around the content
  margin: 0.1,

  // Bounds for smallest/largest possible scale to apply to content
  minScale: 0.2,
  maxScale: 1.5,

  // Optional libraries used to extend on reveal.js
  dependencies: [
      { src: 'reveal.js-3.1.0/lib/js/classList.js', condition: function() { return !document.body.classList; } },
      { src: 'reveal.js-3.1.0/plugin/markdown/marked.js', condition: function() { return !!document.querySelector( '[data-markdown]' ); } },
      { src: 'reveal.js-3.1.0/plugin/markdown/markdown.js', condition: function() { return !!document.querySelector( '[data-markdown]' ); } },
      
      { src: 'reveal.js-3.1.0/plugin/zoom-js/zoom.js', async: true, condition: function() { return !!document.body.classList; } },
      { src: 'reveal.js-3.1.0/plugin/notes/notes.js', async: true, condition: function() { return !!document.body.classList; } }
  ]
});Reveal.addEventListener('slidechanged', function(event) {
    if (Reveal.isFirstSlide()) {
        document.querySelector('.reveal .footer').attributes['class'].value = 'footer first-slide';
        document.querySelector('#geecon-logo').attributes['src'].value = 'images/geecon-logo.png';
    } else {
        document.querySelector('.reveal .footer').attributes['class'].value = 'footer';
        document.querySelector('#geecon-logo').attributes['src'].value = 'images/geecon-logo-small.png';
    }
});
Reveal.addEventListener( 'ready', function( event ) {
    if (Reveal.isFirstSlide()) {
        document.querySelector('.reveal .footer').attributes['class'].value = 'footer first-slide';
        document.querySelector('#geecon-logo').attributes['src'].value = 'images/geecon-logo.png';
    } else {
        document.querySelector('.reveal .footer').attributes['class'].value = 'footer';
        document.querySelector('#geecon-logo').attributes['src'].value = 'images/geecon-logo-small.png';
    }
});</script></body></html>